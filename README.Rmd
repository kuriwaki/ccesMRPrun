---
title: "Running MRP with CCES"
output: github_document
---

<!-- badges: start -->
[![R build status](https://github.com/kuriwaki/ccesMRPrun/workflows/R-CMD-check/badge.svg)](https://github.com/kuriwaki/ccesMRPrun/actions)
<!-- badges: end -->

```{r, eval = FALSE}
remotes::install_github("kuriwaki/ccesMRPrun")
```


```{r, message=FALSE}
library(ccesMRPrun)
library(tidyverse)
```




To prepare, see <www.shirokuriwaki.com/ccesMRPprep>. 

# Fitting

This is a simple wrapper around `brms::brm` but with some custom priors and a binomial model as a default.

```{r, warning=FALSE, message=FALSE}
ff <- "yes | trials(n_response) ~ (1|age) + (1 + female |educ) + clinton_vote + (1|cd)"

# turn into counts
cc_count <- ccesMRPprep::build_counts(cces_GA, model_ff = ff)

fit <- fit_brms_binomial(ff, cc_count, verbose = FALSE)
```



# Poststratification

There are two main methods in this package: modeling and 

```{r}
poststrat_GA <- acs_GA
drw <- poststrat_draws(fit, 
                       poststrat_tgt = poststrat_GA,
                       orig_data = cc_count)
drw
```

# summaries

We often care about the posterior mean and 95 percent credible intervals of the draws. 

```{r}
summ_sims(drw)
```


```{r}
mrp_val <- summ_sims(drw) %>% 
  left_join(distinct(acs_GA, cd, clinton_vote))
```

```{r, fig.w  = 4, fig.h = 4, fig.align = "center"}
library(ggrepel)

scatter_45(mrp_val, clinton_vote, p_mrp_est,
           xlab = "Clinton Vote",
           ylab = "MRP Estimate") +
  geom_text_repel(aes(label = cd))
```

